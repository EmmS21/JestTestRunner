# GetAdvice Module

This module leverages AI to provide personalized financial advice, aiding users in budget management and financial planning. By integrating LangChain with OpenAI's GPT models, the module processes transactional data and user interactions to deliver actionable insights and recommendations.

## Functions

### generate

Simulates a financial advisor, providing insights on weekly spending, budget adherence, and management of shared expenses. It is designed to run twice a week to offer timely financial advice.

**Args:**
- `data` (str): A JSON string containing transaction data for the current and previous weeks, including amounts, categories, and other relevant metadata.
- `openai` (Secret): A Secret object storing the OpenAI API key for authentication and access to OpenAI's AI models.
- `connection` (Secret): A Secret object storing the MongoDB connection string for database access.

**Returns:**
- A JSON string with tailored financial advice, generated by comparing current spending against historical data and considering budget limits and shared financial responsibilities.

**Example Use Case:**

`dagger call generate --data='{"current_week": {"Groceries": "$150", "Utilities": "$120"}, "previous_weeks": {"Groceries": "$130", "Utilities": "$110"}}' --openai=env:OPENAI_SECRET --connection=env:DB_CONNECTION`

### update_prompt

Updates the initial prompt based on user feedback and regenerates advice using the updated prompt. It is triggered each time the user provides feedback on the AI-generated advice.

**Args**

- `feedback` (str): User feedback on the previous advice, used to refine and improve future recommendations.
- `data` (str): A JSON string containing the same spending data as used in the generate function.
- `openai` (Secret): A Secret object storing the OpenAI API key for authentication and access to OpenAI's AI models.
- `connection` (Secret): A Secret object storing the MongoDB connection string for database access.

**Returns**
- A JSON string with updated financial advice, incorporating user feedback and adjusting recommendations accordingly.

**Example Use Case:**
dagger call update_prompt --feedback='I prefer more savings tips.' --data='{"current_week": {"Groceries": "$150", "Utilities": "$120"}, "previous_weeks": {"Groceries": "$130", "Utilities": "$110"}}' --openai=env:OPENAI_SECRET --connection=env:DB_CONNECTION

# Technical Details
Both functions interact with MongoDB to manage conversation states and ensure personalized advice that evolves over time. The generate function establishes an initial context, while update_prompt modifies this context based on user feedback, ensuring advice remains relevant and personalized.

The module aims to empower users with AI-driven insights for better financial discipline and smarter spending habits, making it an invaluable tool for personal finance apps, budgeting tools, and financial advisory services.

# Implementation Details

## GetAdvice Class

### generate
`@function
async def generate(self, data: str, openai: Secret, connection: Secret) -> str:
    # Function implementation...`

### update_prompt
`
@function
async def update_prompt(self, feedback: str, data: str, openai: Secret, connection: Secret) -> str:
    # Function implementation...
`

### authenticate (private function)
`
def authenticate(self, connection_string: str, database: str, collection: str):
    # Function implementation...
`

### save_memory_to_mongodb
`
def save_memory_to_mongodb(self, user_id: str, data: dict, data_type: str, db: Collection) -> None:
    # Function implementation...
`

### get_memory_from_mongodb
`
def get_memory_from_mongodb(self, user_id: str, db: Collection) -> list[dict]:
    # Function implementation...
`